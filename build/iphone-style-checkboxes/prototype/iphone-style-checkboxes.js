var iPhoneStyle=function(a,b){b=Object.extend(Object.clone(iPhoneStyle.defaults),b||{});var c;Object.isString(a)?c=$$(a):c=[a].flatten();return c.each(function(a){if(!!a.match("input[type=checkbox]")){a.setOpacity(0),a.wrap("div",{"class":b.containerClass}),a.insert({after:'<div class="'+b.handleClass+'"><div class="'+b.handleRightClass+'"><div class="'+b.handleCenterClass+'"></div></div></div>'}).insert({after:'<label class="'+b.labelOnClass+'"><span>'+b.checkedLabel+"</span></label>"}).insert({after:'<label class="'+b.labelOffClass+'"><span>'+b.uncheckedLabel+"</span></label>"});var c=a.up().down("."+b.handleClass),d=a.adjacent("."+b.labelOffClass).first(),e=d.down("span"),f=a.adjacent("."+b.labelOnClass).first(),g=f.down("span"),h=a.up();if(b.resizeHandle){var i=f.getWidth()<d.getWidth()?f.getWidth():d.getWidth();c.setStyle({width:i+"px"})}if(b.resizeContainer){var j=f.getWidth()>d.getWidth()?f.getWidth():d.getWidth();h.setStyle({width:j+c.getWidth()+12+"px"})}d.setStyle({width:h.getWidth()-5+"px"});var k=h.getWidth()-c.getWidth()-3;a.checked?(c.setStyle({left:k+"px"}),f.setStyle({width:k+4+"px"}),e.setStyle({marginRight:k+"px"})):(c.setStyle({left:0}),f.setStyle({width:0}),g.setStyle({marginLeft:-k+"px"})),a.change=function(){var d=a.checked,h=c.positionedOffset().first()/k;new Effect.Tween(null,h,Number(d),{duration:b.duration/1e3},function(a){c.setStyle({left:a*k+"px"}),f.setStyle({width:a*k+4+"px"}),e.setStyle({marginRight:-a*k+"px"}),g.setStyle({marginLeft:-(1-a)*k+"px"})})},a.observe("change",a.change);var l=function(a){a.stop(),iPhoneStyle.clicking=c;var b=Event.pointerX(a)||a.changedTouches[0].pageX;iPhoneStyle.dragStartPosition=b-(Number(c.style.left.replace(/px$/,""))||0),Event.stop(a)};h.observe("mousedown",l),h.observe("touchstart",l);var m=function(a){if(iPhoneStyle.clicking==c){a.stop();var b=Event.pointerX(a)||a.changedTouches[0].pageX;b!=iPhoneStyle.dragStartPosition&&(iPhoneStyle.dragging=!0);var d=(b-iPhoneStyle.dragStartPosition)/k;d<0&&(d=0),d>1&&(d=1),c.setStyle({left:d*k+"px"}),f.setStyle({width:d*k+4+"px"}),e.setStyle({marginRight:-d*k+"px"}),g.setStyle({marginLeft:-(1-d)*k+"px"})}};document.observe("mousemove",m),document.observe("touchmove",m),h.observe("mousedown",function(a){a.stop(),iPhoneStyle.clicking=c,iPhoneStyle.dragStartPosition=Event.pointerX(a)-(Number(c.style.left.replace(/px$/,""))||0);return!1});var n=function(b){if(iPhoneStyle.clicking==c){b.stop();if(!iPhoneStyle.dragging){var d=a.checked;a.writeAttribute("checked",!d)}else{var e=Event.pointerX(b)||b.changedTouches[0].pageX,f=(e-iPhoneStyle.dragStartPosition)/k;a.writeAttribute("checked",f>=.5)}iPhoneStyle.clicking=null,iPhoneStyle.dragging=null,a.change()}};document.observe("touchend",n),document.observe("mouseup",n),[h,f,d,c].invoke("observe","mousedown",function(a){a.preventDefault();return!1}),Prototype.Browser.IE&&[h,f,d,c].invoke("observe","startselect",function(a){Event.stop(a);return!1})}})};iPhoneStyle.defaults={duration:200,checkedLabel:"ON",uncheckedLabel:"OFF",resizeHandle:!0,resizeContainer:!0,background:"#fff",containerClass:"iPhoneCheckContainer",labelOnClass:"iPhoneCheckLabelOn",labelOffClass:"iPhoneCheckLabelOff",handleClass:"iPhoneCheckHandle",handleCenterClass:"iPhoneCheckHandleCenter",handleRightClass:"iPhoneCheckHandleRight"}