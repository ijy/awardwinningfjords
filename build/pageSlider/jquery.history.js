/*
 * jQuery history plugin
 * 
 * sample page: http://www.mikage.to/jquery/jquery_history.html
 *
 * Copyright (c) 2006-2009 Taku Sano (Mikage Sawatari)
 * Licensed under the MIT License:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Modified by Lincoln Cooper to add Safari support and only call the callback once during initialization
 * for msie when no initial hash supplied.
 */
jQuery.extend({historyCurrentHash:undefined,historyCallback:undefined,historyIframeSrc:undefined,historyInit:function(a,b){jQuery.historyCallback=a,b&&(jQuery.historyIframeSrc=b);var c=location.hash.replace(/\?.*$/,"");jQuery.historyCurrentHash=c;if(jQuery.browser.msie){jQuery.historyCurrentHash==""&&(jQuery.historyCurrentHash="#"),jQuery("body").prepend('<iframe id="jQuery_history" style="display: none;"'+(jQuery.historyIframeSrc?' src="'+jQuery.historyIframeSrc+'"':"")+"></iframe>");var d=jQuery("#jQuery_history")[0],e=d.contentWindow.document;e.open(),e.close(),e.location.hash=c}else jQuery.browser.safari&&(jQuery.historyBackStack=[],jQuery.historyBackStack.length=history.length,jQuery.historyForwardStack=[],jQuery.lastHistoryLength=history.length,jQuery.isFirst=!0);c&&jQuery.historyCallback(c.replace(/^#/,"")),setInterval(jQuery.historyCheck,100)},historyAddHistory:function(a){jQuery.historyBackStack.push(a),jQuery.historyForwardStack.length=0,this.isFirst=!0},historyCheck:function(){if(jQuery.browser.msie){var a=jQuery("#jQuery_history")[0],b=a.contentDocument||a.contentWindow.document,c=b.location.hash.replace(/\?.*$/,"");c!=jQuery.historyCurrentHash&&(location.hash=c,jQuery.historyCurrentHash=c,jQuery.historyCallback(c.replace(/^#/,"")))}else if(jQuery.browser.safari){jQuery.lastHistoryLength==history.length&&jQuery.historyBackStack.length>jQuery.lastHistoryLength&&jQuery.historyBackStack.shift();if(!jQuery.dontCheck){var d=history.length-jQuery.historyBackStack.length;jQuery.lastHistoryLength=history.length;if(d){jQuery.isFirst=!1;if(d<0)for(var e=0;e<Math.abs(d);e++)jQuery.historyForwardStack.unshift(jQuery.historyBackStack.pop());else for(var e=0;e<d;e++)jQuery.historyBackStack.push(jQuery.historyForwardStack.shift());var f=jQuery.historyBackStack[jQuery.historyBackStack.length-1];f!=undefined&&(jQuery.historyCurrentHash=location.hash.replace(/\?.*$/,""),jQuery.historyCallback(f))}else if(jQuery.historyBackStack[jQuery.historyBackStack.length-1]==undefined&&!jQuery.isFirst){if(location.hash){var c=location.hash;jQuery.historyCallback(location.hash.replace(/^#/,""))}else{var c="";jQuery.historyCallback("")}jQuery.isFirst=!0}}}else{var c=location.hash.replace(/\?.*$/,"");c!=jQuery.historyCurrentHash&&(jQuery.historyCurrentHash=c,jQuery.historyCallback(c.replace(/^#/,"")))}},historyLoad:function(a){var b;a=decodeURIComponent(a.replace(/\?.*$/,"")),jQuery.browser.safari?b=a:(b="#"+a,location.hash=b),jQuery.historyCurrentHash=b;if(jQuery.browser.msie){var c=jQuery("#jQuery_history")[0],d=c.contentWindow.document;d.open(),d.close(),d.location.hash=b,jQuery.lastHistoryLength=history.length,jQuery.historyCallback(a)}else if(jQuery.browser.safari){jQuery.dontCheck=!0,this.historyAddHistory(a);var e=function(){jQuery.dontCheck=!1};window.setTimeout(e,200),jQuery.historyCallback(a),location.hash=b}else jQuery.historyCallback(a)}})